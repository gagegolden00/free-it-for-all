<section class="flex flex-col border-4">
  <%= form_with model: @service_job, url: admin_service_jobs_path, data: {turbo: false}, clsss: "flex-flex-col" do |service_job_field| %>
    <!-- We should set the job number up to be auto generated hidden field,
    maybe give them a settings option that will allow them to select
    the current job number(last job created) so the next job will follow
    in sequential order. There will be a unique constraint on this field and this will
    allow them to re-sync if something happens -->
    <div class="flex flex-col justify-center mx-auto w-1/2 h-full border-2 border-red-600 gap-10">

      <div id="serviceJobFields" class="border border-green-600 flex flex-col">
        <p class="text-2xl">Service job</p>
        <%= service_job_field.label :job_number %>
        <%= service_job_field.text_field :job_number, class: "border border-black" %>

        <%= service_job_field.label :status %>
        <%= service_job_field.select :status, options_for_select(service_job_statuses), class: "border border-black" %>

        <%= service_job_field.label :description %>
        <%= service_job_field.text_area :description, class: "border border-black" %>

        <%= service_job_field.label :contract_amount %>
        <%= service_job_field.number_field :contract_amount, class: "border border-black" %>

        <%= service_job_field.label :work_type %>
        <%= service_job_field.text_field :work_type, class: "border border-black" %>

        <!-- existing customer | Slim select would come in handy here but maybe
            there is something from flowbite? A searchable dropdown select? -->
        <fieldset id="customerSelect" class="">
          <%= service_job_field.label :select_customer %>
          <%= service_job_field.select :customer_id, options_for_select(@customers.map { |customer| [customer.name, customer.id] }) %>
        </fieldset>

        <div data-controller="toggle-hidden change-text">
          <button
            data-action="click->toggle-hidden#toggle click->change-text#toggleNewServiceJobCustomerButtonText"
            data-target-id="customerFields customerSelect"
            type="button"
            class="text-green-500 p-1 border border-green-500 hover:bg-gray-300 rounded">
              Add new customer
          </button>
        </div>

      </div>

      <fieldset id="customerFields" class="border border-blue-600 flex flex-col hidden" disabled="true">
        <!-- new customer -->
        <p class="text-2xl"> New Customer</p>
        <%= service_job_field.fields_for :customer do |customer_field|%>
          <%= customer_field.label :name %>
          <%= customer_field.text_field :name, class: "border border-black" %>

          <%= customer_field.label :phone_number %>
          <%= customer_field.telephone_field :phone_number, type: 'tel', class: "border border-black" %>

          <%= customer_field.label :email %>
          <%= customer_field.email_field :email, class: "border border-black" %>

          <%= customer_field.label :address%>
          <%= customer_field.text_field :address, class: "border border-black" %>

          <%= customer_field.label :city %>
          <%= customer_field.text_field :city, class: "border border-black" %>

          <%= customer_field.label :state %>
          <%= customer_field.select :state, options_for_select(us_states), class: "border border-black" %>

          <%= customer_field.label :zip_code %>
          <%= customer_field.text_field :zip_code, autocomplete: 'postal-code', maxlength: "5", class: "border border-black" %>

          <div id="pointOfContactFields" class="border border-red-600 flex flex-col">
            <p class="text-2xl">New point of contact</p>
            <%= customer_field.fields_for :point_of_contact do |point_of_contact_field| %>
              <%= point_of_contact_field.label :name %>
              <%= point_of_contact_field.text_field :name, class: "border border-black" %>

              <%= point_of_contact_field.label :phone_number %>
              <%= point_of_contact_field.telephone_field :phone_number, type: 'tel', class: "border border-black" %>

              <%= point_of_contact_field.label :email %>
              <%= point_of_contact_field.email_field :email, class: "border border-black" %>
            <% end %>
          </div>

        <% end %>
      </fieldset>

      <div data-controller="toggle-hidden">
        <button
          data-action="click->toggle-hidden#toggle"
          data-target-id="workSiteFields"
          type="button" class="text-green-500 p-1 border border-green-500 hover:bg-gray-300 rounded">
            Add new work site
        </button>
      </div>
      <fieldset id="workSiteFields" class="border border-green-600 flex flex-col hidden" disabled="true">
        <p class="text-2xl">Work site</p>
        <%= service_job_field.fields_for :work_site do |work_site_field| %>
          <%= work_site_field.label :name %>
          <%= work_site_field.text_field :name, class: "border border-black" %>

          <%= work_site_field.label :address %>
          <%= work_site_field.text_field :address, class: "border border-black" %>

          <%= work_site_field.label :city %>
          <%= work_site_field.text_field :city, class: "border border-black" %>

          <%= work_site_field.label :state %>
          <%= work_site_field.select :state, options_for_select(us_states), class: "border border-black" %>

          <%= work_site_field.label :zip_code %>
          <%= work_site_field.text_field :zip_code, autocomplete: 'postal-code', maxlength: "5", class: "border border-black"  %>

          <%= work_site_field.label :email %>
          <%= work_site_field.email_field :email, class: "border border-black" %>

          <%= work_site_field.label :phone_number %>
          <%= work_site_field.telephone_field :phone_number, class: "border border-black" %>
        <% end %>
      </fieldset>
      <div>
        <%= service_job_field.submit "Create service job", class: "text-green-500 p-1 border border-green-500 hover:bg-gray-300 rounded hover:cursor-pointer"%>
      </div>
    </div>

  <% end %>
</section>
